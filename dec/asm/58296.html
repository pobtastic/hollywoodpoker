<!DOCTYPE html>
<html>
<head>
<title>Hollywood Poker: Routine at 58296</title>
<meta charset="utf-8" />
<link rel="stylesheet" type="text/css" href="../skoolkit.css" />
<link rel="stylesheet" type="text/css" href="../skoolkit-dark.css" />
<link rel="stylesheet" type="text/css" href="../skoolkit-wide.css" />
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-75RERFCHBG"></script>
<script>
window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-75RERFCHBG');
</script>
</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a href="../index.html"><img alt="logo" src="../images/logo.png" /></a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="58266.html">58266</a>
</td>
<td class="up">Up: <a href="../maps/all.html#58296">Map</a></td>
<td class="next">
Next: <a href="58422.html">58422</a>
</td>
</tr>
</table>
<div class="description">58296: Print Cards</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="5">
<div class="details">
<div class="paragraph">
Used by the routine at <a href="58170.html">CheckCardType</a>.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label">PrintAceCard</td>
<td class="address-2"><span id="58296"></span>58296</td>
<td class="instruction">SUB 3</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>-=3.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="58298"></span>58298</td>
<td class="instruction">DEC B</td>
<td class="comment-1" rowspan="3">Decrease <span class="register">B</span> by three.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="58299"></span>58299</td>
<td class="instruction">DEC B</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="58300"></span>58300</td>
<td class="instruction">DEC B</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="58301"></span>
<div class="comments">
<div class="paragraph">
This entry point is used by the routine at <a href="58170.html">CheckCardType</a>.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label">PrintNumberCard</td>
<td class="address-2"><span id="58301"></span>58301</td>
<td class="instruction">LD C,B</td>
<td class="comment-1" rowspan="1">Copy the original card value into <span class="register">C</span> as we need <span class="register">B</span> for the loop below.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="58302"></span>58302</td>
<td class="instruction">LD B,A</td>
<td class="comment-1" rowspan="1">Set a counter in <span class="register">B</span> of the card number (this is the lower four bits).</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="58303"></span>58303</td>
<td class="instruction">INC B</td>
<td class="comment-1" rowspan="1">Increment <span class="register">B</span> by one, due to the way the loop below works.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="58304"></span>58304</td>
<td class="instruction">LD DE,30</td>
<td class="comment-1" rowspan="1">The card UDG data blocks are 0030 in length, so store this in <span class="register">DE</span> for the calculation.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="58307"></span>58307</td>
<td class="instruction">LD HL,58422</td>
<td class="comment-1" rowspan="1">The card data begins from <a href="58422.html">58422</a> so store this in <span class="register">HL</span>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="58310"></span>58310</td>
<td class="instruction">XOR A</td>
<td class="comment-1" rowspan="1">Reset the flags.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="58311"></span>58311</td>
<td class="instruction">SBC HL,DE</td>
<td class="comment-1" rowspan="1">Subtract <span class="register">DE</span> from <span class="register">HL</span> as the loop will add it back and then it will be pointing to the beginning again.</td>
</tr>
<tr>
<td class="asm-label">FindCardUDGData_Loop</td>
<td class="address-2"><span id="58313"></span>58313</td>
<td class="instruction">ADD HL,DE</td>
<td class="comment-1" rowspan="1">Add 0030 to <span class="register">HL</span> to move to the next block of card UDG data.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="58314"></span>58314</td>
<td class="instruction">DJNZ <a href="58296.html#58313">FindCardUDGData_Loop</a></td>
<td class="comment-1" rowspan="1">Decrease the card value counter by one and loop back to <a href="58296.html#58313">FindCardUDGData_Loop</a> until the appropriate card UDG data block is found.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="58316"></span>58316</td>
<td class="instruction">LD (58723),HL</td>
<td class="comment-1" rowspan="1">Write the card UDG data block pointer to *<a href="58723.html">PointerCardUDGData</a>.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="58319"></span>
<div class="comments">
<div class="paragraph">
Work out the suit.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="58319"></span>58319</td>
<td class="instruction">LD B,4</td>
<td class="comment-1" rowspan="3">Using the original card value, shift the upper four bits to be the lower four bits.</td>
</tr>
<tr>
<td class="asm-label">SuitShift_Loop</td>
<td class="address-2"><span id="58321"></span>58321</td>
<td class="instruction">SRL C</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="58323"></span>58323</td>
<td class="instruction">DJNZ <a href="58296.html#58321">SuitShift_Loop</a></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="58325"></span>58325</td>
<td class="instruction">LD A,C</td>
<td class="comment-1" rowspan="2">Write the calculated suit to *<a href="58722.html">CurrentCardSuit</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="58326"></span>58326</td>
<td class="instruction">LD (58722),A</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="58329"></span>
<div class="comments">
<div class="paragraph">
Now calculate the suit UDG data address.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="58329"></span>58329</td>
<td class="instruction">LD B,C</td>
<td class="comment-1" rowspan="1">Set a counter in <span class="register">B</span> of the calculated suit (this is the upper four bits).</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="58330"></span>58330</td>
<td class="instruction">INC B</td>
<td class="comment-1" rowspan="1">Increment <span class="register">B</span> by one, due to the way the loop below works.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="58331"></span>58331</td>
<td class="instruction">LD DE,88</td>
<td class="comment-1" rowspan="1">The suit UDG data blocks are 0088 in length, so store this in <span class="register">DE</span> for the calculation.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="58334"></span>58334</td>
<td class="instruction">LD HL,59071</td>
<td class="comment-1" rowspan="1">The suit UDG data begins from <a href="59071.html">59071</a> so store this in <span class="register">HL</span>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="58337"></span>58337</td>
<td class="instruction">XOR A</td>
<td class="comment-1" rowspan="1">Reset the flags.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="58338"></span>58338</td>
<td class="instruction">SBC HL,DE</td>
<td class="comment-1" rowspan="1">Subtract <span class="register">DE</span> from <span class="register">HL</span> as the loop will add it back and then it will be pointing to the beginning again.</td>
</tr>
<tr>
<td class="asm-label">FindSuitUDGData_Loop</td>
<td class="address-2"><span id="58340"></span>58340</td>
<td class="instruction">ADD HL,DE</td>
<td class="comment-1" rowspan="1">Add 0088 to <span class="register">HL</span> to move to the next block of suit UDG data.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="58341"></span>58341</td>
<td class="instruction">DJNZ <a href="58296.html#58340">FindSuitUDGData_Loop</a></td>
<td class="comment-1" rowspan="1">Decrease the suit counter by one and loop back to <a href="58296.html#58340">FindSuitUDGData_Loop</a> until the appropriate suit UDG data block is found.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="58343"></span>58343</td>
<td class="instruction">PUSH DE</td>
<td class="comment-1" rowspan="2">Set a counter in <span class="register">BC</span> to the length of the suit UDG data block: 0088.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="58344"></span>58344</td>
<td class="instruction">POP BC</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="58345"></span>58345</td>
<td class="instruction">LD DE,58983</td>
<td class="comment-1" rowspan="1">Set the target in <span class="register">DE</span> to <a href="58983.html">Buffer_CardData</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="58348"></span>58348</td>
<td class="instruction">LDIR</td>
<td class="comment-1" rowspan="1">Copy the suit UDG data block to the card data buffer.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="58350"></span>
<div class="comments">
<div class="paragraph">
Set the card character-set to be the in-use font.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="58350"></span>58350</td>
<td class="instruction">LD HL,58207</td>
<td class="comment-1" rowspan="2">Write 58207 to *<a rel="noopener nofollow" href="https://skoolkit.ca/disassemblies/rom/hex/asm/5C36.html">CHARS</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="58353"></span>58353</td>
<td class="instruction">LD (23606),HL</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="58356"></span>
<div class="comments">
<div class="paragraph">
Handle setting the colour of the card.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="58356"></span>58356</td>
<td class="instruction">LD A,19</td>
<td class="comment-1" rowspan="4">BRIGHT: ON.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="58358"></span>58358</td>
<td class="instruction">RST 16</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="58359"></span>58359</td>
<td class="instruction">LD A,1</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="58361"></span>58361</td>
<td class="instruction">RST 16</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="58362"></span>58362</td>
<td class="instruction">LD A,16</td>
<td class="comment-1" rowspan="4">Set INK: 


BLACK.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="58364"></span>58364</td>
<td class="instruction">RST 16</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="58365"></span>58365</td>
<td class="instruction">LD A,0</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="58367"></span>58367</td>
<td class="instruction">RST 16</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="58368"></span>58368</td>
<td class="instruction">LD A,(58722)</td>
<td class="comment-1" rowspan="3">Jump to <a href="58296.html#58381">PrintCard</a> if *<a href="58722.html">CurrentCardSuit</a> is 2 or higher (so Spades or Clubs).</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="58371"></span>58371</td>
<td class="instruction">CP 2</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="58373"></span>58373</td>
<td class="instruction">JR NC,<a href="58296.html#58381">PrintCard</a></td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="58375"></span>
<div class="comments">
<div class="paragraph">
Else this card is a Diamonds or Hearts so set the INK appropriately.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="58375"></span>58375</td>
<td class="instruction">LD A,16</td>
<td class="comment-1" rowspan="4">Set INK: 


RED.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="58377"></span>58377</td>
<td class="instruction">RST 16</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="58378"></span>58378</td>
<td class="instruction">LD A,2</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="58380"></span>58380</td>
<td class="instruction">RST 16</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="58381"></span>
<div class="comments">
<div class="paragraph">
This entry point is used by the routine at <a href="58170.html">CheckCardType</a>.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label">PrintCard</td>
<td class="address-2"><span id="58381"></span>58381</td>
<td class="instruction">LD A,(59423)</td>
<td class="comment-1" rowspan="1">Fetch the current *<a href="59423.html">CardPosition</a> and store this in <span class="register">A</span>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="58384"></span>58384</td>
<td class="instruction">LD C,6</td>
<td class="comment-1" rowspan="1">Each card is 6 character blocks in width, store this count in <span class="register">C</span>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="58386"></span>58386</td>
<td class="instruction">LD B,A</td>
<td class="comment-1" rowspan="1">Set a counter in <span class="register">B</span> of the card position we're processing.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="58387"></span>
<div class="comments">
<div class="paragraph">
Subtract 6 from 38 the number of times for the current card position. For example; position 1 is: 38 - (1 * 6) = 32.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="58387"></span>58387</td>
<td class="instruction">LD A,38</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>=38.</td>
</tr>
<tr>
<td class="asm-label">FindCardPosition_Loop</td>
<td class="address-2"><span id="58389"></span>58389</td>
<td class="instruction">SUB C</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>-=<span class="register">C</span>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="58390"></span>58390</td>
<td class="instruction">DJNZ <a href="58296.html#58389">FindCardPosition_Loop</a></td>
<td class="comment-1" rowspan="1">Decrease card position counter by one and loop back to <a href="58296.html#58389">FindCardPosition_Loop</a> until the counter is zero.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="58392"></span>58392</td>
<td class="instruction">LD C,A</td>
<td class="comment-1" rowspan="1">Store the result in <span class="register">C</span>, this is the column position.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="58393"></span>58393</td>
<td class="instruction">LD B,12</td>
<td class="comment-1" rowspan="1">Set <span class="register">B</span> to 12 this is the row position.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="58395"></span>58395</td>
<td class="instruction">LD DE,(58723)</td>
<td class="comment-1" rowspan="1">Retrieve *<a href="58723.html">PointerCardUDGData</a> for the current card.</td>
</tr>
<tr>
<td class="asm-label">PrintCard_Loop</td>
<td class="address-2"><span id="58399"></span>58399</td>
<td class="instruction">PUSH DE</td>
<td class="comment-1" rowspan="1">Stash the UDG data pointer on the stack.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="58400"></span>58400</td>
<td class="instruction">LD A,B</td>
<td class="comment-1" rowspan="3">Jump to <a href="58296.html#58420">PrintCard_Finish</a> when the current print line is equal to 7.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="58401"></span>58401</td>
<td class="instruction">CP 7</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="58403"></span>58403</td>
<td class="instruction">JR Z,<a href="58296.html#58420">PrintCard_Finish</a></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="58405"></span>58405</td>
<td class="instruction">CALL 3554</td>
<td class="comment-1" rowspan="1">Call <a rel="noopener nofollow" href="https://skoolkit.ca/disassemblies/rom/hex/asm/0DD9.html#0DE2">3554</a> (CL_SET) to change the co-ordinates in <span class="register">BC</span> to a screen buffer address.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="58408"></span>58408</td>
<td class="instruction">POP DE</td>
<td class="comment-1" rowspan="1">Restore the UDG data pointer from the stack.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="58409"></span>58409</td>
<td class="instruction">PUSH BC</td>
<td class="comment-1" rowspan="1">Stash <span class="register">BC</span> on the stack.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="58410"></span>58410</td>
<td class="instruction">LD BC,6</td>
<td class="comment-1" rowspan="1">Set the number of characters to print in <span class="register">BC</span> (0006).</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="58413"></span>58413</td>
<td class="instruction">CALL 8252</td>
<td class="comment-1" rowspan="1">Call <a rel="noopener nofollow" href="https://skoolkit.ca/disassemblies/rom/hex/asm/1FFC.html#203C">PR_STRING</a> to print to the screen.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="58416"></span>58416</td>
<td class="instruction">POP BC</td>
<td class="comment-1" rowspan="1">Restore <span class="register">BC</span> from the stack.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="58417"></span>58417</td>
<td class="instruction">DEC B</td>
<td class="comment-1" rowspan="1">Decrease <span class="register">B</span> by one.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="58418"></span>58418</td>
<td class="instruction">JR <a href="58296.html#58399">PrintCard_Loop</a></td>
<td class="comment-1" rowspan="1">Jump to <a href="58296.html#58399">PrintCard_Loop</a>.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="58420"></span>
<div class="comments">
<div class="paragraph">
Housekeeping and return.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label">PrintCard_Finish</td>
<td class="address-2"><span id="58420"></span>58420</td>
<td class="instruction">POP DE</td>
<td class="comment-1" rowspan="1">Restore <span class="register">DE</span> from the stack.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="58421"></span>58421</td>
<td class="instruction">RET</td>
<td class="comment-1" rowspan="1">Return.</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="58266.html">58266</a>
</td>
<td class="up">Up: <a href="../maps/all.html#58296">Map</a></td>
<td class="next">
Next: <a href="58422.html">58422</a>
</td>
</tr>
</table>
<footer>
<div class="release"></div>
<div class="copyright">&copy; 1986 Golden Games &copy; 2024 ArcadeGeek LTD.</div>
<div class="created">Created using <a href="https://skoolkit.ca">SkoolKit</a> 9.3.</div>
<div class="repository">Link to <a rel="noopener nofollow" href="https://github.com/pobtastic/hollywoodpoker/">Source code</a>.</div>
<div><a href="../../asm/E3B8.html">Switch to hexadecimal</a>.</div>
</footer>
</body>
</html>